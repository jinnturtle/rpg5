#include "Floor_map.hpp"

#include <stdexcept>

Floor_map::Floor_map()
: w{0}
, h{0}
{}

Tile* Floor_map::get_tile(int x, int y)
{
    if(
        x >= 0 && x < this->w
        && y >= 0 && y < this->h
    ) {
        return this->tiles[x + (y * this->w)];
    } else {
        return nullptr;
    }
}

void Floor_map::generate_test_level()
{
    //init tile dictionary
    this->tile_dict.push_back(Tile(FLOOR));
    this->tile_dict.push_back(Tile(WALL));

    this->w = 60;
    std::string data(
        "............................................................"
        "............................................................"
        "............................................................"
        "............................................................"
        "............................................................"
        "..................#########................................."
        "..................#.......#................................."
        "..................#.......#................................."
        "..................#.......#................................."
        "..................#........................................."
        "..................#.......#................................."
        "..................#.......#................................."
        "..................#.......#................................."
        "..................#########................................."
        "............................................................"
        "............................................................"
        "............................................................"
        "............................................................"
        "............................................................"
        "............................................................"
    );
    
    //bad dimensions
    if(data.size() % w != 0) {
        throw std::logic_error("Floor_map data dimensions misalligned");
    }
    this->h = data.size() / w;

    //TODO allocate tiles space in one go
    for(auto ch : data) {
        switch(ch) {
            case '.': this->tiles.push_back(&this->tile_dict[0]); break;
            case '#': this->tiles.push_back(&this->tile_dict[1]); break;
            default: throw std::runtime_error("unrecognised symbol in level data");
        }
    }
}
